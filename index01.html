<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>myACSHS | Enterprise SIS v45.0</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

<style>
/* ===================================================================
   1.0 ENTERPRISE DESIGN SYSTEM
   =================================================================== */
:root {
    /* Brand Colors */
    --primary: #0f172a;       /* Slate 900 - Deep Navy */
    --primary-light: #334155; /* Slate 700 */
    --accent: #2563eb;        /* Royal Blue */
    --accent-hover: #1d4ed8;
    
    /* Functional Colors */
    --success: #10b981;
    --warning: #f59e0b;
    --danger: #ef4444;
    --info: #06b6d4;

    /* Backgrounds */
    --bg-body: #f1f5f9;       /* Slate 100 */
    --bg-card: #ffffff;
    --bg-panel: #f8fafc;      /* Slate 50 */

    /* Typography */
    --text-main: #0f172a;
    --text-muted: #64748b;
    --font-main: 'Plus Jakarta Sans', sans-serif;
    --font-mono: 'JetBrains Mono', monospace;

    /* UI Elements */
    --radius-sm: 6px;
    --radius-md: 12px;
    --radius-lg: 16px;
    --header-height: 70px;
    --sidebar-width: 280px;
    
    /* Shadows */
    --shadow-sm: 0 1px 3px rgba(0,0,0,0.1);
    --shadow-md: 0 4px 6px -1px rgba(0,0,0,0.1);
    --shadow-lg: 0 20px 25px -5px rgba(0,0,0,0.1);
}

/* ===================================================================
   2.0 GLOBAL RESET & UTILITIES
   =================================================================== */
* { margin: 0; padding: 0; box-sizing: border-box; outline: none; }
body { font-family: var(--font-main); background: var(--bg-body); color: var(--text-main); line-height: 1.5; min-height: 100vh; display: flex; flex-direction: column; overflow-x: hidden; }

/* Typography */
h1, h2, h3, h4 { font-weight: 800; letter-spacing: -0.025em; color: var(--text-main); }
small { font-size: 0.85em; color: var(--text-muted); }

/* Buttons */
button { cursor: pointer; border: none; font-family: inherit; transition: all 0.2s ease; }
.btn-primary { background: var(--accent); color: white; padding: 12px 24px; border-radius: var(--radius-md); font-weight: 700; font-size: 0.95rem; }
.btn-primary:hover { background: var(--accent-hover); transform: translateY(-1px); box-shadow: 0 4px 12px rgba(37, 99, 235, 0.2); }
.btn-danger { background: var(--danger); color: white; padding: 8px 16px; border-radius: var(--radius-sm); font-weight: 600; font-size: 0.85rem; }
.btn-danger:hover { background: #dc2626; }
.btn-ghost { background: transparent; color: var(--text-muted); padding: 8px 16px; border-radius: var(--radius-md); font-weight: 600; }
.btn-ghost:hover { background: var(--bg-panel); color: var(--text-main); }
.btn-icon { width: 36px; height: 36px; display: flex; align-items: center; justify-content: center; border-radius: 50%; color: var(--text-muted); background: var(--bg-panel); }
.btn-icon:hover { background: var(--primary-light); color: white; }

/* Inputs */
input, select { width: 100%; padding: 12px 16px; border: 1.5px solid #e2e8f0; border-radius: var(--radius-md); font-size: 0.95rem; background: #fff; transition: 0.2s; font-family: inherit; }
input:focus, select:focus { border-color: var(--accent); box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.1); }

/* Animations */
@keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

/* ===================================================================
   3.0 AUTHENTICATION MODULE
   =================================================================== */
#auth-layer { position: fixed; inset: 0; background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); z-index: 9999; display: flex; align-items: center; justify-content: center; padding: 20px; }

.auth-card { background: white; width: 100%; max-width: 440px; padding: 40px; border-radius: 24px; box-shadow: var(--shadow-lg); animation: slideUp 0.5s cubic-bezier(0.16, 1, 0.3, 1); position: relative; overflow: hidden; }
.auth-card::before { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 6px; background: linear-gradient(90deg, var(--accent), var(--info)); }

.brand-header { text-align: center; margin-bottom: 30px; }
.brand-logo { width: 80px; height: 80px; border-radius: 16px; margin-bottom: 15px; box-shadow: var(--shadow-md); }

.form-group { margin-bottom: 20px; position: relative; }
.form-label { display: block; font-size: 0.75rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em; color: var(--text-muted); margin-bottom: 8px; }
.pass-toggle { position: absolute; right: 16px; top: 40px; color: var(--text-muted); cursor: pointer; font-size: 1.1rem; }
.pass-toggle:hover { color: var(--accent); }

.auth-footer { margin-top: 25px; display: flex; justify-content: space-between; font-size: 0.85rem; font-weight: 600; color: var(--text-muted); }
.link { color: var(--accent); cursor: pointer; } .link:hover { text-decoration: underline; }

/* ===================================================================
   4.0 DASHBOARD LAYOUT (Responsive Sidebar)
   =================================================================== */
#app-layer { display: none; min-height: 100vh; flex-direction: column; }

/* Top Navigation */
.navbar { height: var(--header-height); background: white; border-bottom: 1px solid #e2e8f0; display: flex; align-items: center; justify-content: space-between; padding: 0 32px; position: sticky; top: 0; z-index: 100; box-shadow: var(--shadow-sm); }
.nav-brand { display: flex; align-items: center; gap: 12px; font-weight: 800; font-size: 1.25rem; color: var(--primary); }
.nav-brand img { width: 40px; border-radius: 8px; }
.nav-user { display: flex; align-items: center; gap: 16px; }
.user-badge { text-align: right; line-height: 1.2; }
.user-name { display: block; font-weight: 700; font-size: 0.9rem; }
.user-role { font-size: 0.75rem; color: var(--success); font-weight: 600; text-transform: uppercase; }

/* Layout Grid */
.layout-grid { display: grid; grid-template-columns: var(--sidebar-width) 1fr; min-height: calc(100vh - var(--header-height)); }

/* Sidebar */
.sidebar { background: white; border-right: 1px solid #e2e8f0; padding: 24px; display: flex; flex-direction: column; gap: 8px; position: sticky; top: var(--header-height); height: calc(100vh - var(--header-height)); overflow-y: auto; }
.menu-label { font-size: 0.75rem; font-weight: 800; color: var(--text-muted); text-transform: uppercase; margin: 20px 0 10px 12px; letter-spacing: 0.05em; }
.nav-item { padding: 12px 16px; border-radius: var(--radius-md); color: var(--text-muted); font-weight: 600; font-size: 0.95rem; cursor: pointer; display: flex; align-items: center; gap: 12px; transition: 0.2s; }
.nav-item:hover { background: var(--bg-panel); color: var(--primary); }
.nav-item.active { background: var(--primary); color: white; box-shadow: 0 4px 12px rgba(15, 23, 42, 0.2); }
.nav-item i { width: 20px; text-align: center; font-size: 1.1rem; }

/* Main Content */
.main-content { padding: 32px; overflow-y: auto; }
.panel-view { display: none; animation: fadeIn 0.3s ease; }
.panel-view.active { display: block; }

.panel-header { margin-bottom: 24px; display: flex; justify-content: space-between; align-items: flex-end; border-bottom: 2px solid #e2e8f0; padding-bottom: 20px; }
.page-title { font-size: 1.5rem; color: var(--primary); }
.page-subtitle { color: var(--text-muted); font-size: 0.9rem; margin-top: 4px; }

/* ===================================================================
   5.0 COMPONENTS
   =================================================================== */
/* Stats Cards */
.stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 20px; margin-bottom: 30px; }
.stat-card { background: white; padding: 24px; border-radius: var(--radius-lg); border: 1px solid #e2e8f0; box-shadow: var(--shadow-sm); display: flex; align-items: center; gap: 20px; }
.stat-icon { width: 56px; height: 56px; border-radius: 12px; background: var(--bg-panel); color: var(--accent); display: flex; align-items: center; justify-content: center; font-size: 1.5rem; }
.stat-info h3 { font-size: 1.75rem; margin-bottom: 4px; }
.stat-info span { color: var(--text-muted); font-size: 0.85rem; font-weight: 600; text-transform: uppercase; }

/* Tables */
.table-container { background: white; border-radius: var(--radius-lg); border: 1px solid #e2e8f0; overflow: hidden; box-shadow: var(--shadow-sm); }
.data-table { width: 100%; border-collapse: collapse; }
.data-table th { background: var(--bg-panel); text-align: left; padding: 16px 24px; font-size: 0.75rem; font-weight: 800; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; border-bottom: 1px solid #e2e8f0; }
.data-table td { padding: 16px 24px; border-bottom: 1px solid #f1f5f9; color: var(--text-main); font-size: 0.9rem; }
.data-table tr:last-child td { border-bottom: none; }
.data-table tr:hover td { background: #f8fafc; }

/* Schedule Grid */
.sched-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 24px; }
.day-column { background: white; border: 1px solid #e2e8f0; border-radius: var(--radius-lg); overflow: hidden; }
.day-head { background: var(--primary); color: white; padding: 12px 20px; font-weight: 700; text-transform: uppercase; font-size: 0.85rem; }
.class-item { padding: 16px 20px; border-bottom: 1px solid #f1f5f9; display: flex; gap: 16px; align-items: flex-start; }
.class-time { font-family: var(--font-mono); font-size: 0.8rem; font-weight: 700; color: var(--text-muted); min-width: 90px; }
.class-info b { display: block; font-size: 0.95rem; color: var(--primary); margin-bottom: 2px; }
.class-info span { font-size: 0.85rem; color: var(--text-muted); }

/* Badges */
.badge { padding: 4px 10px; border-radius: 99px; font-size: 0.75rem; font-weight: 700; text-transform: uppercase; }
.badge-pass { background: #dcfce7; color: #166534; }
.badge-fail { background: #fee2e2; color: #991b1b; }
.badge-pending { background: #fef3c7; color: #92400e; }

/* Modals */
.modal { position: fixed; inset: 0; background: rgba(15, 23, 42, 0.6); backdrop-filter: blur(4px); z-index: 2000; display: none; align-items: center; justify-content: center; padding: 20px; }
.modal-content { background: white; width: 100%; max-width: 500px; padding: 32px; border-radius: 20px; box-shadow: var(--shadow-lg); animation: slideUp 0.3s ease; }

/* Toast */
.toast { position: fixed; bottom: 30px; right: 30px; background: var(--primary); color: white; padding: 16px 24px; border-radius: 12px; font-weight: 600; box-shadow: var(--shadow-lg); transform: translateY(100px); transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); z-index: 3000; display: flex; align-items: center; gap: 12px; }
.toast.active { transform: translateY(0); }

/* Mobile Responsive */
@media (max-width: 1024px) {
    .layout-grid { grid-template-columns: 1fr; }
    .sidebar { display: none; position: fixed; inset: 0; z-index: 1000; width: 80%; box-shadow: var(--shadow-lg); }
    .sidebar.active { display: flex; }
}
</style>
</head>
<body>

<div id="auth-layer">
    <div id="box-login" class="auth-card">
        <div class="brand-header">
            <img src="acshslogo.jpg" class="brand-logo">
            <h2>Portal Access</h2>
            <small>Antipolo City Senior High School</small>
        </div>
        
        <div class="form-group">
            <label class="form-label">Access Role</label>
            <select id="login-role"><option value="student">Student</option><option value="admin">Administrator</option></select>
        </div>
        <div class="form-group">
            <label class="form-label">ID Number / Username</label>
            <input type="text" id="login-id" placeholder="e.g. 2024-0001">
        </div>
        <div class="form-group">
            <label class="form-label">Password</label>
            <input type="password" id="login-pass" placeholder="••••••••">
            <i class="fa-solid fa-eye pass-toggle" onclick="app.togglePass('login-pass')"></i>
        </div>
        
        <button class="btn-primary" style="width:100%" onclick="auth.login()">Secure Login</button>
        
        <div class="auth-footer">
            <span class="link" onclick="ui.swapAuth('box-forgot')">Forgot Password?</span>
            <span class="link" onclick="ui.swapAuth('box-reg')">Create Account</span>
        </div>
    </div>

    <div id="box-reg" class="auth-card" style="display:none">
        <div class="brand-header">
            <h3>Student Registry</h3>
            <small>Create your academic profile</small>
        </div>
        <div class="form-group"><label class="form-label">Full Name</label><input type="text" id="r-name"></div>
        <div class="form-group"><label class="form-label">Student ID</label><input type="text" id="r-id"></div>
        <div class="form-group"><label class="form-label">Enrollment Slip (112233)</label><input type="text" id="r-slip"></div>
        <div class="form-group">
            <label class="form-label">Create Password</label>
            <input type="password" id="r-pass">
            <i class="fa-solid fa-eye pass-toggle" onclick="app.togglePass('r-pass')"></i>
        </div>
        <button class="btn-primary" style="width:100%" onclick="auth.register()">Register</button>
        <button class="btn-ghost" style="width:100%; margin-top:10px" onclick="ui.swapAuth('box-login')">Cancel</button>
    </div>

    <div id="box-forgot" class="auth-card" style="display:none">
        <div class="brand-header">
            <h3>Account Recovery</h3>
            <small>Verify identity to reset credentials</small>
        </div>
        <div class="form-group"><label class="form-label">Student ID</label><input type="text" id="f-id"></div>
        <div class="form-group"><label class="form-label">Slip Code</label><input type="text" id="f-slip"></div>
        <div class="form-group"><label class="form-label">New Password</label><input type="password" id="f-pass"></div>
        <button class="btn-primary" style="width:100%" onclick="auth.reset()">Reset Password</button>
        <button class="btn-ghost" style="width:100%; margin-top:10px" onclick="ui.swapAuth('box-login')">Back to Login</button>
    </div>
</div>

<div id="app-layer">
    <nav class="navbar">
        <div class="nav-brand">
            <img src="acshslogo.jpg">
            <span>myACSHS</span>
        </div>
        <div class="nav-user">
            <div class="user-badge">
                <span class="user-name" id="nav-name">Loading...</span>
                <span class="user-role" id="nav-role">GUEST</span>
            </div>
            <button class="btn-danger" onclick="auth.logout()"><i class="fa-solid fa-power-off"></i></button>
        </div>
    </nav>

    <div class="layout-grid">
        <aside class="sidebar" id="sidebar-menu">
            </aside>

        <main class="main-content" id="main-container">
            </main>
    </div>
</div>

<div id="modal-grade" class="modal">
    <div class="modal-content">
        <div style="display:flex; justify-content:space-between; margin-bottom:20px">
            <h3>Edit Grades</h3>
            <button class="btn-icon" onclick="ui.closeModal()"><i class="fa-solid fa-xmark"></i></button>
        </div>
        <h4 id="edit-student-name" style="margin-bottom:20px; color:var(--accent)">---</h4>
        <div id="grade-inputs-container"></div>
        <button class="btn-primary" style="width:100%; margin-top:20px" onclick="admin.saveGrades()">Save Changes</button>
    </div>
</div>

<div id="toast" class="toast">
    <i class="fa-solid fa-circle-check"></i>
    <span id="toast-msg">Action Successful</span>
</div>

<script>
/**
 * ----------------------------------------------------------------------------
 * 1. CONFIGURATION & DATA SEEDING
 * ----------------------------------------------------------------------------
 */
const CONFIG = {
    DB_NAME: 'ACSHS_SIS_V45',
    VALID_SLIPS: ["112233"],
    SUBJECTS: [
        "Media & Info Literacy", 
        "JAVA Programming", 
        "Inquiries & Immersion", 
        "Work Immersion", 
        "PE & Health"
    ],
    // FULL M-F SCHEDULE
    SCHEDULE: {
        "Monday": [
            { t: "06:15 - 07:15", s: "Homeroom Guidance", i: "Adviser" },
            { t: "07:15 - 08:15", s: "JAVA Programming", i: "Espiritu" },
            { t: "08:35 - 09:35", s: "PE & Health", i: "Jordan" },
            { t: "09:35 - 10:35", s: "Inquiries & Immersion", i: "Inocian" },
            { t: "10:35 - 11:35", s: "Work Immersion", i: "Espiritu" }
        ],
        "Tuesday": [
            { t: "06:15 - 07:15", s: "Media & Info Literacy", i: "Sofia" },
            { t: "07:15 - 08:15", s: "JAVA Programming", i: "Espiritu" },
            { t: "08:35 - 09:35", s: "JAVA Programming", i: "Espiritu" },
            { t: "09:35 - 10:35", s: "Inquiries & Immersion", i: "Inocian" }
        ],
        "Wednesday": [
            { t: "06:15 - 07:15", s: "Media & Info Literacy", i: "Sofia" },
            { t: "07:15 - 08:15", s: "JAVA Programming", i: "Espiritu" },
            { t: "08:35 - 09:35", s: "Inquiries & Immersion", i: "Inocian" },
            { t: "09:35 - 10:35", s: "Work Immersion", i: "Espiritu" }
        ],
        "Thursday": [
            { t: "06:15 - 07:15", s: "Media & Info Literacy", i: "Sofia" },
            { t: "07:15 - 08:15", s: "JAVA Programming", i: "Espiritu" },
            { t: "08:35 - 09:35", s: "JAVA Programming", i: "Espiritu" },
            { t: "09:35 - 10:35", s: "Inquiries & Immersion", i: "Inocian" }
        ],
        "Friday": [
            { t: "06:15 - 07:15", s: "Media & Info Literacy", i: "Sofia" },
            { t: "07:15 - 08:15", s: "JAVA Programming", i: "Espiritu" },
            { t: "08:35 - 09:35", s: "Work Immersion", i: "Espiritu" },
            { t: "09:35 - 10:35", s: "Faculty Consultation", i: "Staff" }
        ]
    }
};

const INIT_USERS = [
    { 
        id: "2024-0001", name: "Dela Cruz, Juan", pass: "123", track: "ICT 1202",
        grades: { "Media & Info Literacy": 92, "JAVA Programming": 94, "Inquiries & Immersion": 89, "Work Immersion": 91, "PE & Health": 90 },
        attendance: [
            { date: '2026-01-10', status: 'Present' },
            { date: '2026-01-11', status: 'Present' },
            { date: '2026-01-12', status: 'Absent' }
        ]
    }
];

/**
 * ----------------------------------------------------------------------------
 * 2. DATABASE ENGINE (LOCALSTORAGE)
 * ----------------------------------------------------------------------------
 */
const db = {
    load: () => JSON.parse(localStorage.getItem(CONFIG.DB_NAME) || JSON.stringify(INIT_USERS)),
    save: (data) => localStorage.setItem(CONFIG.DB_NAME, JSON.stringify(data)),
    session: (u) => u ? localStorage.setItem('SIS_SESSION', JSON.stringify(u)) : JSON.parse(localStorage.getItem('SIS_SESSION')),
    clearSession: () => localStorage.removeItem('SIS_SESSION')
};

/**
 * ----------------------------------------------------------------------------
 * 3. APPLICATION CONTROLLER
 * ----------------------------------------------------------------------------
 */
const app = {
    user: null,
    editingIndex: null,

    init() {
        const s = db.session();
        if(s) { this.user = s; this.renderApp(); }
    },

    togglePass(id) {
        const el = document.getElementById(id);
        el.type = el.type === 'password' ? 'text' : 'password';
    },

    // RENDER MAIN APPLICATION
    renderApp() {
        document.getElementById('auth-layer').style.display = 'none';
        document.getElementById('app-layer').style.display = 'flex';
        
        // Header Info
        document.getElementById('nav-name').innerText = this.user.name;
        document.getElementById('nav-role').innerText = this.user.role === 'admin' ? 'ADMINISTRATOR' : 'STUDENT';

        // Render Sidebar Menu
        this.renderSidebar();
        
        // Render Default Page
        if(this.user.role === 'admin') this.renderAdminHome();
        else this.renderStudentHome();
    },

    renderSidebar() {
        const sb = document.getElementById('sidebar-menu');
        let html = `<div class="menu-label">Main Menu</div>`;
        
        if(this.user.role === 'admin') {
            html += `
                <div class="nav-item active" onclick="app.nav(this, 'adminHome')"><i class="fa-solid fa-chart-pie"></i> Admin Home</div>
                <div class="nav-item" onclick="app.nav(this, 'manageStudents')"><i class="fa-solid fa-users-gear"></i> Manage Students</div>
                <div class="nav-item" onclick="app.nav(this, 'gradeEditor')"><i class="fa-solid fa-pen-to-square"></i> Grades</div>
                <div class="nav-item" onclick="app.nav(this, 'attendanceMgr')"><i class="fa-solid fa-calendar-check"></i> Attendance</div>
            `;
        } else {
            html += `
                <div class="nav-item active" onclick="app.nav(this, 'studentHome')"><i class="fa-solid fa-house"></i> Home</div>
                <div class="nav-item" onclick="app.nav(this, 'classSchedule')"><i class="fa-solid fa-calendar-days"></i> Class Schedule</div>
                <div class="nav-item" onclick="app.nav(this, 'myGrades')"><i class="fa-solid fa-graduation-cap"></i> My Grades</div>
                <div class="nav-item" onclick="app.nav(this, 'myAttendance')"><i class="fa-solid fa-clock-rotate-left"></i> Attendance</div>
            `;
        }
        sb.innerHTML = html;
    },

    nav(el, page) {
        document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
        el.classList.add('active');
        
        // Routing
        if(page === 'adminHome') this.renderAdminHome();
        else if(page === 'manageStudents') this.renderManageStudents();
        else if(page === 'gradeEditor') this.renderGradeEditor();
        else if(page === 'attendanceMgr') this.renderAttendanceMgr();
        else if(page === 'studentHome') this.renderStudentHome();
        else if(page === 'classSchedule') this.renderClassSchedule();
        else if(page === 'myGrades') this.renderMyGrades();
        else if(page === 'myAttendance') this.renderMyAttendance();
    },

    /* --- ADMIN PAGES --- */
    
    // 1. Admin Home
    renderAdminHome() {
        const users = db.load();
        const total = users.length;
        const passed = users.filter(u => Object.values(u.grades).every(g => g >= 75)).length;
        
        let html = `
            <div class="panel-view active">
                <div class="panel-header">
                    <div><h2 class="page-title">Admin Dashboard</h2><p class="page-subtitle">System Overview & Analytics</p></div>
                    <button class="btn-primary" onclick="app.nav(document.querySelectorAll('.nav-item')[1], 'manageStudents')">Add Student</button>
                </div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fa-solid fa-users"></i></div>
                        <div class="stat-info"><h3>${total}</h3><span>Total Students</span></div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="color:var(--success)"><i class="fa-solid fa-certificate"></i></div>
                        <div class="stat-info"><h3>${passed}</h3><span>Good Standing</span></div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="color:var(--warning)"><i class="fa-solid fa-clock"></i></div>
                        <div class="stat-info"><h3>Active</h3><span>Semester Status</span></div>
                    </div>
                </div>
            </div>
        `;
        document.getElementById('main-container').innerHTML = html;
    },

    // 2. Manage Students
    renderManageStudents() {
        const users = db.load();
        let html = `
            <div class="panel-view active">
                <div class="panel-header">
                    <div><h2 class="page-title">Manage Students</h2><p class="page-subtitle">Directory & Enrollment</p></div>
                </div>
                <div class="table-container">
                    <table class="data-table">
                        <thead><tr><th>Name</th><th>ID Number</th><th>Track</th><th>Actions</th></tr></thead>
                        <tbody>
        `;
        users.forEach((u, i) => {
            html += `<tr>
                <td><b>${u.name}</b></td><td>${u.id}</td><td>${u.track}</td>
                <td><button class="btn-danger" onclick="admin.deleteUser(${i})">Delete</button></td>
            </tr>`;
        });
        html += `</tbody></table></div></div>`;
        document.getElementById('main-container').innerHTML = html;
    },

    // 3. Grade Editor
    renderGradeEditor() {
        const users = db.load();
        let html = `
            <div class="panel-view active">
                <div class="panel-header">
                    <div><h2 class="page-title">Grade Management</h2><p class="page-subtitle">Update Scholastic Records</p></div>
                </div>
                <div class="table-container">
                    <table class="data-table">
                        <thead><tr><th>Student Name</th><th>ID</th><th>G.P.A.</th><th>Action</th></tr></thead>
                        <tbody>
        `;
        users.forEach((u, i) => {
            const vals = Object.values(u.grades);
            const gpa = (vals.reduce((a,b)=>a+b,0)/vals.length).toFixed(1);
            html += `<tr>
                <td><b>${u.name}</b></td><td>${u.id}</td><td><span class="badge badge-pending">${gpa}</span></td>
                <td><button class="btn-primary" onclick="admin.openGradeModal(${i})">Edit Grades</button></td>
            </tr>`;
        });
        html += `</tbody></table></div></div>`;
        document.getElementById('main-container').innerHTML = html;
    },

    // 4. Attendance Manager
    renderAttendanceMgr() {
        const users = db.load();
        let html = `
            <div class="panel-view active">
                <div class="panel-header">
                    <div><h2 class="page-title">Attendance Tracker</h2><p class="page-subtitle">Mark daily presence</p></div>
                    <button class="btn-primary" onclick="admin.markAllPresent()">Mark All Present</button>
                </div>
                <div class="table-container">
                    <table class="data-table">
                        <thead><tr><th>Student</th><th>Last Record</th><th>Action</th></tr></thead>
                        <tbody>
        `;
        users.forEach((u, i) => {
            const last = u.attendance.length > 0 ? u.attendance[u.attendance.length-1].date + ' (' + u.attendance[u.attendance.length-1].status + ')' : 'No Records';
            html += `<tr>
                <td><b>${u.name}</b></td><td>${last}</td>
                <td style="display:flex; gap:10px">
                    <button class="btn-ghost" style="color:var(--success); background:#dcfce7" onclick="admin.addAttendance(${i}, 'Present')">Present</button>
                    <button class="btn-ghost" style="color:var(--danger); background:#fee2e2" onclick="admin.addAttendance(${i}, 'Absent')">Absent</button>
                </td>
            </tr>`;
        });
        html += `</tbody></table></div></div>`;
        document.getElementById('main-container').innerHTML = html;
    },

    /* --- STUDENT PAGES --- */

    // 1. Student Home
    renderStudentHome() {
        const g = Object.values(this.user.grades);
        const gpa = (g.reduce((a,b)=>a+b,0)/g.length).toFixed(1);
        const present = this.user.attendance.filter(a => a.status === 'Present').length;
        
        let html = `
            <div class="panel-view active">
                <div class="panel-header">
                    <div><h2 class="page-title">My Dashboard</h2><p class="page-subtitle">Welcome back, ${this.user.name}</p></div>
                </div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fa-solid fa-graduation-cap"></i></div>
                        <div class="stat-info"><h3>${gpa}</h3><span>Current G.P.A</span></div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="color:var(--success)"><i class="fa-solid fa-calendar-check"></i></div>
                        <div class="stat-info"><h3>${present}</h3><span>Days Present</span></div>
                    </div>
                </div>
                <div class="table-container" style="padding:30px; text-align:center">
                    <h3 style="margin-bottom:10px">Student Status: REGULAR</h3>
                    <p style="color:var(--text-muted)">You are cleared for the upcoming examinations.</p>
                </div>
            </div>
        `;
        document.getElementById('main-container').innerHTML = html;
    },

    // 2. Class Schedule
    renderClassSchedule() {
        let html = `
            <div class="panel-view active">
                <div class="panel-header"><h2 class="page-title">Weekly Schedule</h2></div>
                <div class="sched-container">
        `;
        Object.entries(CONFIG.SCHEDULE).forEach(([day, sessions]) => {
            html += `<div class="day-column"><div class="day-head">${day}</div>`;
            sessions.forEach(s => {
                html += `<div class="class-item">
                    <div class="class-time">${s.t}</div>
                    <div class="class-info"><b>${s.s}</b><span>Instr: ${s.i}</span></div>
                </div>`;
            });
            html += `</div>`;
        });
        html += `</div></div>`;
        document.getElementById('main-container').innerHTML = html;
    },

    // 3. My Grades
    renderMyGrades() {
        let html = `
            <div class="panel-view active">
                <div class="panel-header">
                    <h2 class="page-title">Academic Records</h2>
                    <button class="btn-ghost" onclick="window.print()"><i class="fa-solid fa-print"></i> Print</button>
                </div>
                <div class="table-container">
                    <table class="data-table">
                        <thead><tr><th>Subject Description</th><th>Final Grade</th><th>Remark</th></tr></thead>
                        <tbody>
        `;
        Object.entries(this.user.grades).forEach(([sub, grade]) => {
            const badge = grade >= 75 ? 'badge-pass' : 'badge-fail';
            const remark = grade >= 75 ? 'PASSED' : 'FAILED';
            html += `<tr><td><b>${sub}</b></td><td>${grade}</td><td><span class="badge ${badge}">${remark}</span></td></tr>`;
        });
        html += `</tbody></table></div></div>`;
        document.getElementById('main-container').innerHTML = html;
    },

    // 4. My Attendance
    renderMyAttendance() {
        let html = `
            <div class="panel-view active">
                <div class="panel-header"><h2 class="page-title">Attendance History</h2></div>
                <div class="table-container">
                    <table class="data-table">
                        <thead><tr><th>Date</th><th>Status</th></tr></thead>
                        <tbody>
        `;
        if(this.user.attendance.length === 0) {
            html += `<tr><td colspan="2" style="text-align:center">No records found.</td></tr>`;
        } else {
            [...this.user.attendance].reverse().forEach(a => {
                const color = a.status === 'Present' ? 'var(--success)' : 'var(--danger)';
                html += `<tr><td>${a.date}</td><td><b style="color:${color}">${a.status}</b></td></tr>`;
            });
        }
        html += `</tbody></table></div></div>`;
        document.getElementById('main-container').innerHTML = html;
    }
};

/**
 * ----------------------------------------------------------------------------
 * 4. AUTHENTICATION LOGIC
 * ----------------------------------------------------------------------------
 */
const auth = {
    login() {
        const role = document.getElementById('login-role').value;
        const id = document.getElementById('login-id').value.trim();
        const pass = document.getElementById('login-pass').value;

        if(!id || !pass) return ui.notify("Please fill all fields", true);

        // Admin Check
        if(role === 'admin' && id === 'admin' && pass === 'admin123') {
            app.user = { role: 'admin', name: 'System Admin' };
            app.renderApp();
            return;
        }

        // Student Check
        const users = db.load();
        const u = users.find(user => user.id === id && user.pass === pass);
        
        if(u) {
            app.user = { role: 'student', ...u };
            app.renderApp();
        } else {
            ui.notify("Invalid Credentials", true);
        }
    },

    register() {
        const slip = document.getElementById('r-slip').value;
        if(!CONFIG.VALID_SLIPS.includes(slip)) return ui.notify("Invalid Slip Code", true);

        const users = db.load();
        const id = document.getElementById('r-id').value;
        
        if(users.some(u => u.id === id)) return ui.notify("ID already registered", true);

        const newUser = {
            id: id,
            name: document.getElementById('r-name').value,
            pass: document.getElementById('r-pass').value,
            track: "ICT 1202",
            attendance: [],
            grades: {}
        };
        // Init grades
        CONFIG.SUBJECTS.forEach(s => newUser.grades[s] = 0);

        users.push(newUser);
        db.save(users);
        ui.notify("Registration Success!");
        ui.swapAuth('box-login');
    },

    reset() {
        const slip = document.getElementById('f-slip').value;
        if(!CONFIG.VALID_SLIPS.includes(slip)) return ui.notify("Verification Failed", true);

        const users = db.load();
        const id = document.getElementById('f-id').value;
        const idx = users.findIndex(u => u.id === id);

        if(idx === -1) return ui.notify("ID Not Found", true);

        users[idx].pass = document.getElementById('f-pass').value;
        db.save(users);
        ui.notify("Password Reset Success");
        ui.swapAuth('box-login');
    },

    logout() {
        location.reload();
    }
};

/**
 * ----------------------------------------------------------------------------
 * 5. ADMIN LOGIC
 * ----------------------------------------------------------------------------
 */
const admin = {
    deleteUser(idx) {
        if(confirm("Delete this student permanently?")) {
            let u = db.load();
            u.splice(idx, 1);
            db.save(u);
            app.renderManageStudents();
            ui.notify("Student Deleted");
        }
    },

    openGradeModal(idx) {
        app.editingIndex = idx;
        const u = db.load()[idx];
        document.getElementById('edit-student-name').innerText = u.name;
        
        let html = '';
        Object.entries(u.grades).forEach(([sub, val]) => {
            html += `<div class="form-group"><label class="form-label">${sub}</label><input type="number" class="grade-inp" data-s="${sub}" value="${val}"></div>`;
        });
        document.getElementById('grade-inputs-container').innerHTML = html;
        document.getElementById('modal-grade').style.display = 'flex';
    },

    saveGrades() {
        let users = db.load();
        const inputs = document.querySelectorAll('.grade-inp');
        inputs.forEach(inp => {
            users[app.editingIndex].grades[inp.dataset.s] = parseInt(inp.value);
        });
        db.save(users);
        ui.notify("Grades Updated");
        ui.closeModal();
        app.renderGradeEditor();
    },

    addAttendance(idx, status) {
        let users = db.load();
        const date = new Date().toISOString().split('T')[0];
        users[idx].attendance.push({ date: date, status: status });
        db.save(users);
        ui.notify(`Marked ${status}`);
        app.renderAttendanceMgr();
    },

    markAllPresent() {
        let users = db.load();
        const date = new Date().toISOString().split('T')[0];
        users.forEach(u => u.attendance.push({ date: date, status: 'Present' }));
        db.save(users);
        ui.notify("All students marked Present");
        app.renderAttendanceMgr();
    }
};

/**
 * ----------------------------------------------------------------------------
 * 6. UI HELPERS
 * ----------------------------------------------------------------------------
 */
const ui = {
    swapAuth(id) {
        ['box-login', 'box-reg', 'box-forgot'].forEach(b => document.getElementById(b).style.display = 'none');
        document.getElementById(id).style.display = 'block';
    },
    
    notify(msg, isErr=false) {
        const t = document.getElementById('toast');
        t.innerHTML = `<i class="fa-solid ${isErr ? 'fa-triangle-exclamation' : 'fa-circle-check'}"></i> ${msg}`;
        t.style.background = isErr ? 'var(--danger)' : 'var(--primary)';
        t.classList.add('active');
        setTimeout(() => t.classList.remove('active'), 3000);
    },

    closeModal() {
        document.getElementById('modal-grade').style.display = 'none';
    }
};

// Start System
db.load(); // Init DB check
</script>
</body>
</html>
